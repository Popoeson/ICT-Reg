<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Owu College of Management Technology - Student Screening</title>

  <!-- ✅ Secure CSP allowing inline styles/scripts via nonce -->
  <meta
    http-equiv="Content-Security-Policy"
    content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; connect-src 'self' https://testpro-mvh8.onrender.com https://ict-reg.vercel.app;"
  />

  <!-- ✅ STYLES SECTION -->
  <style nonce="r4nd0m123">
    :root {
      --main-bg: #f5f5f5;
      --accent: #008000;
      --text-color: #333;
      --border-color: #ccc;
    }

    body {
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 0;
      background: var(--main-bg);
      color: var(--text-color);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: white;
      padding: 1rem;
      border-bottom: 3px solid var(--accent);
    }

    header img {
      width: 60px;
      height: 60px;
      object-fit: contain;
    }

    header div {
      text-align: center;
      font-weight: bold;
      font-size: 14px;
    }

    form {
      max-width: 900px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
      color: var(--accent);
      border-bottom: 2px solid var(--accent);
      padding-bottom: 5px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 0.2rem;
    }

    input, select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: 5px;
      outline: none;
    }

    .submit-btn {
      display: block;
      margin: 2rem auto 0;
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }

    .submit-btn:hover {
      background: #006600;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid var(--border-color);
      padding: 0.5rem;
      text-align: left;
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      text-align: center;
    }

    .confirm-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 5px;
      margin: 0.5rem;
      cursor: pointer;
    }

    .close-btn {
      background: #ccc;
      color: black;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 5px;
      margin: 0.5rem;
      cursor: pointer;
    }

    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
    }

    .lightbox img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 10px;
    }
  </style>
</head>

<body>
  <header>
    <img src="left-logo.png" alt="Left Logo" />
    <div>
      Owu College of Management Technology, Wasinmi<br />
      Department of Computer Science and Technology<br />
      <small>Online Student Screening</small>
    </div>
    <img src="right-logo.png" alt="Right Logo" />
  </header>

  <form id="regForm">
    <h2>Personal Information</h2>
    <div class="grid">
      <div><label>Surname</label><input required name="surname" /></div>
      <div><label>First Name</label><input required name="firstname" /></div>
      <div><label>Middle Name</label><input name="middlename" /></div>
      <div>
        <label>Phone Number</label>
        <input type="tel" name="phone" required pattern="[0-9]{11}" placeholder="e.g. 09163836546" />
      </div>
      <div><label>Email</label><input type="email" name="email" required /></div>
      <div>
        <label>Marital Status</label>
        <select name="marital" required>
          <option value="">Select</option>
          <option>Single</option>
          <option>Married</option>
        </select>
      </div>
      <div>
        <label>Disability</label>
        <input type="checkbox" id="disabilityNone" /> None
        <input name="disability" placeholder="If any, please signify" />
      </div>
      <div><label>State of Origin</label><input required name="stateOrigin" /></div>
      <div><label>LGA (State of Origin)</label><input required name="lgaOrigin" /></div>
      <div><label>Residential Address</label><input required name="address" /></div>
      <div><label>LGA (Residential Address)</label><input required name="lgaResidence" /></div>
      <div>
        <label>Department</label>
        <select name="department" id="department" required>
          <option value="">Select</option>
          <option value="COS">Computer Science</option>
          <option value="COE">Computer Engineering</option>
          <option value="BUS">Business Administration</option>
          <option value="ACC">Accountancy</option>
          <option value="MCM">Mass Communication</option>
          <option value="ELE">Electrical Engineering</option>
          <option value="EST">Estate Management</option>
          <option value="SLT">Science Lab Tech</option>
        </select>
      </div>
      <div>
        <label>Registration Number</label>
        <input id="regNo" readonly placeholder="Auto-generated" />
      </div>
    </div>

    <h2>Next of Kin</h2>
    <div class="grid">
      <div><label>Surname</label><input required name="nokSurname" /></div>
      <div><label>First Name</label><input required name="nokFirstname" /></div>
      <div><label>Middle Name</label><input name="nokMiddlename" /></div>
      <div>
        <label>Phone Number</label>
        <input type="tel" name="nokPhone" required pattern="[0-9]{11}" placeholder="e.g. 09163836546" />
      </div>
      <div>
        <label>Marital Status</label>
        <select name="nokMarital" required>
          <option value="">Select</option>
          <option>Single</option>
          <option>Married</option>
        </select>
      </div>
      <div><label>Relationship</label><input required name="nokRelation" /></div>
      <div class="full"><label>Residential Address</label><input required name="nokAddress" /></div>
    </div>

    <h2>Uploads (Images Only)</h2>
    <label>Upload O'Level Result</label><input type="file" accept="image/*" id="fileOlevel" required />
    <label>Upload JAMB Result</label><input type="file" accept="image/*" id="fileJamb" required />
    <label>Upload State of Origin</label><input type="file" accept="image/*" id="fileState" required />
    <label>Upload Birth Certificate</label><input type="file" accept="image/*" id="fileBirth" required />
    <label>Upload NIN</label><input type="file" accept="image/*" id="fileNin" required />
    <label>Upload School Acceptance Fee</label><input type="file" accept="image/*" id="fileFee" required />

    <button type="submit" class="submit-btn">Submit</button>
  </form>

  <div class="modal-overlay" id="previewModal">
    <div class="modal">
      <h3>Registration Preview</h3>
      <div id="previewContent"></div>
      <button class="confirm-btn" id="confirmBtn">Confirm & Submit</button>
      <button class="close-btn" id="closeBtn">Edit Info</button>
    </div>
  </div>

  <div class="lightbox" id="lightbox"><img src="" alt="Preview" /></div>

  <!-- ✅ SCRIPT SECTION -->
  <script nonce="r4nd0m123">
    const form = document.getElementById("regForm");
    const modal = document.getElementById("previewModal");
    const confirmBtn = document.getElementById("confirmBtn");
    const closeBtn = document.getElementById("closeBtn");
    const previewContent = document.getElementById("previewContent");

    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      let html = "<table style='width:100%;border-collapse:collapse'>";
      formData.forEach((val, key) => {
        html += `<tr><td><b>${key}</b></td><td>${val}</td></tr>`;
      });
      html += "</table>";
      previewContent.innerHTML = html;

      modal.style.display = "flex";
    });

    closeBtn.onclick = () => (modal.style.display = "none");

    confirmBtn.onclick = async () => {
      const formData = new FormData(form);
      const res = await fetch("https://testpro-mvh8.onrender.com/api/register", {
        method: "POST",
        body: formData,
      });

      if (res.ok) {
        alert("Registration submitted successfully!");
        modal.style.display = "none";
        form.reset();
      } else {
        alert("Error submitting form!");
      }
    };
  </script>
</body>
                                                     </html>
