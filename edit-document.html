<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Documents</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{background:#f9fbfd;color:#333;}
header{background:#1e73be;color:white;padding:1rem 2rem;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
header h1{font-size:1.5rem;margin-bottom:.3rem;}
header p{font-size:.95rem;opacity:0.9;}
main{max-width:1000px;margin:2rem auto;background:white;padding:2rem;border-radius:10px;box-shadow:0 3px 10px rgba(0,0,0,0.05);}
h2.section-title{color:#1e73be;font-size:1.2rem;margin-bottom:.8rem;border-left:4px solid #1e73be;padding-left:.5rem;}
.form-section{margin-bottom:2rem;}
label{display:block;font-weight:500;margin-bottom:.3rem;font-size:.9rem;}
input[type="file"],select,input[type="text"],input[type="number"]{width:100%;padding:.6rem .7rem;border:1px solid #c8d3e1;border-radius:6px;margin-bottom:1rem;outline:none;transition: all 0.2s ease;}
input:focus,select:focus{border-color:#1e73be;box-shadow:0 0 0 2px rgba(30,115,190,0.15);}
button[type="submit"]{background:#1e73be;color:white;padding:.8rem 1.8rem;border-radius:6px;border:none;font-weight:500;cursor:pointer;display:block;margin-left:auto;}
button[type="submit"]:hover{background:#125a99;}
#spinnerOverlay {position: fixed;inset: 0;background: rgba(0,0,0,0.4);display: none;align-items: center;justify-content: center;z-index: 300;}
#spinnerOverlay div {width: 50px;height: 50px;border: 6px solid #f3f3f3;border-top: 6px solid #1e73be;border-radius: 50%;animation: spin 1s linear infinite;}
@keyframes spin {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}
@media(max-width:500px){main{padding:1.5rem;}}
</style>
</head>
<body>

<header>
  <h1>Edit Your Documents</h1>
  <p>Update your academic and administrative records below.</p>
</header>

<main>
  <form id="uploadForm">
    <!-- MATRIC NUMBER -->
    <section class="form-section">
      <h2 class="section-title">Student Information</h2>
      <label for="matricNumber">Matric Number</label>
      <input type="text" id="matricNumber" placeholder="e.g. COS/023001">
    </section>

    <!-- O'LEVEL DETAILS -->
    <section class="form-section">
      <h2 class="section-title">O'Level Result Information</h2>
      <label>How many O'Level results do you have?</label>
      <select id="olevelCount">
        <option value="">Select Option</option>
        <option value="1">One Result</option>
        <option value="2">Two Results</option>
      </select>
      <div id="olevelDetails"></div>
    </section>

    <!-- JAMB -->
    <section class="form-section">
      <h2 class="section-title">JAMB Documents</h2>
      <label>JAMB Reg Number</label>
      <input type="text" id="jambRegNo" placeholder="e.g. 2022345678AB">
      <label>JAMB Score</label>
      <input type="number" id="jambScore" placeholder="e.g. 250">
      <label>JAMB Result Upload</label>
      <input type="file" id="jambUpload" accept="image/*">
      <label>JAMB Admission Letter Upload</label>
      <input type="file" id="jambAdmission" accept="image/*">
    </section>

    <!-- SCHOOL FORMS -->
    <section class="form-section">
      <h2 class="section-title">School Forms</h2>
      <label>Application Form</label><input type="file" id="applicationForm" accept="image/*">
      <label>Acceptance Form</label><input type="file" id="acceptanceForm" accept="image/*">
      <label>Guarantor's Form</label><input type="file" id="guarantorForm" accept="image/*">
      <label>Code of Conduct</label><input type="file" id="codeOfConduct" accept="image/*">
    </section>

    <!-- COURSE & FEES -->
    <section class="form-section">
      <h2 class="section-title">Course & Receipts</h2>
      <label>ND1 - First Semester Form</label><input type="file" id="nd1First" accept="image/*">
      <label>ND1 - Second Semester Form</label><input type="file" id="nd1Second" accept="image/*">
      <label>ND2 - First Semester Form</label><input type="file" id="nd2First" accept="image/*">
      <label>ND2 - Second Semester Form</label><input type="file" id="nd2Second" accept="image/*">
      <label>ICT Receipts</label>
      <input type="file" id="ict1" accept="image/*"><input type="file" id="ict2" accept="image/*"><input type="file" id="ict3" accept="image/*"><input type="file" id="ict4" accept="image/*">
      <label>School Fees Receipts</label>
      <input type="file" id="fee1" accept="image/*"><input type="file" id="fee2" accept="image/*"><input type="file" id="fee3" accept="image/*"><input type="file" id="fee4" accept="image/*">
    </section>

    <!-- OTHER DOCUMENTS -->
    <section class="form-section">
      <h2 class="section-title">Other Documents</h2>
      <label>Acceptance Fee Upload</label><input type="file" id="acceptanceFee" accept="image/*">
      <label>State of Origin Upload</label><input type="file" id="stateOfOrigin" accept="image/*">
      <label>NIN Upload</label><input type="file" id="nin" accept="image/*">
      <label>Departmental Fee Receipt</label><input type="file" id="deptFee" accept="image/*">
    </section>

    <button type="submit">Submit Updates</button>
  </form>
</main>

<!-- LOADING SPINNER -->
<div id="spinnerOverlay"><div></div></div>

<script>
// ===== O'LEVEL DYNAMIC FORM =====
const olevelCount = document.getElementById("olevelCount");
const olevelDetails = document.getElementById("olevelDetails");

olevelCount.addEventListener("change", () => {
  olevelDetails.innerHTML = "";
  const count = parseInt(olevelCount.value);
  if (!count) return;

  for (let i = 1; i <= count; i++) {
    const wrapper = document.createElement("div");
    wrapper.style.border = "1px solid #c8d3e1";
    wrapper.style.padding = "1rem";
    wrapper.style.marginBottom = "1rem";
    wrapper.style.borderRadius = "8px";

    wrapper.innerHTML = `
      <h3 style="color:#1e73be;">O'Level Result ${i}</h3>
      <label>Exam Type</label>
      <input type="text" id="examType${i}" placeholder="e.g. WAEC, NECO, NABTEB">
      <label>Serial Number</label>
      <input type="text" id="serialNumber${i}" placeholder="Enter Serial Number">
      <label>Pin / Token</label>
      <input type="text" id="pin${i}" placeholder="Enter Pin or Token">
    `;
    olevelDetails.appendChild(wrapper);
  }
});

// ===== FORM SUBMISSION =====
const spinner = document.getElementById("spinnerOverlay");
document.getElementById("uploadForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  spinner.style.display = "flex";

  try {
    const formData = new FormData();
    const studentId = localStorage.getItem("studentId");
    formData.append("studentId", studentId || "demo");

    // Matric number
    const matricNumber = document.getElementById("matricNumber").value.trim();
    formData.append("matricNumber", matricNumber);

    // O'Level data
    const olevelData = [];
    const count = parseInt(olevelCount.value);
    for (let i = 1; i <= count; i++) {
      const examType = document.getElementById(`examType${i}`)?.value.trim();
      const serialNumber = document.getElementById(`serialNumber${i}`)?.value.trim();
      const pin = document.getElementById(`pin${i}`)?.value.trim();
      if (examType || serialNumber || pin) {
        olevelData.push({ examType, serialNumber, pin });
      }
    }
    formData.append("olevelData", JSON.stringify(olevelData));

    // JAMB info
    const jambRegNo = document.getElementById("jambRegNo").value.trim();
    const jambScore = document.getElementById("jambScore").value.trim();
    formData.append("jambRegNo", jambRegNo);
    formData.append("jambScore", jambScore);

    // Files
    const fileInputs = document.querySelectorAll("input[type=file]");
    fileInputs.forEach(input => {
      if (input.files[0]) formData.append(input.id, input.files[0]);
    });

    // Send
    const res = await fetch("https://ict-reg.onrender.com/upload-documents", {
      method: "POST",
      body: formData
    });
    const data = await res.json();
    alert(data.success ? "Documents updated successfully!" : "Upload failed: " + data.message);
  } catch (err) {
    console.error(err);
    alert("Server error. Please try again.");
  } finally {
    spinner.style.display = "none";
  }
});
</script>
</body>
</html>